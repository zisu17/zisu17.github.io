---
title: "[CDC] 트랜잭션 로그 기반 CDC 파이프라인 구현 (1)"
excerpt: "Change Data Capture의 개념과 트랜잭션 로그 기반 구현 방법"

categories:
  - Data
tags:
  - [Data]

permalink: /data/[CDC]-트랜잭션-로그-기반-CDC-파이프라인-구현-1/

toc: true
toc_sticky: true

date: 2024-01-10
last_modified_at: 2024-01-10
---

### CDC(Change Data Capture)의 개념
![image](https://github.com/zisu17/zisu17/assets/108858121/428a853a-28da-4071-8e0c-9bea1212535a)

CDC는 데이터 변경사항을 추적하고 이 변경사항에 대해 필요한 후속 처리를 자동화하는 기술이다. 
소스 시스템 데이터의 변경을 감지하여 타겟 시스템에 실시간에 근접한 속도로 통합이 가능하고 데이터 복제나 백업, 데이터 분석, 실시간 대시보드 업데이트 등 다양한 용도로 활용할 수 있다. 

예를 들어 사용자 행동 로그에 따라 실시간으로 데이터를 분석해 상품을 추천하는 서비스를 만들고 싶을 때 CDC를 활용하면 운영 시스템의 데이터 변화에 따라 분석용 데이터베이스를 빠르게 구축할 수 있는 것이다. 
특히 차차 공부하며 실습할 트랜잭션 로그 기반 CDC를 활용하면 되면 운영 시스템에 큰 부하없이 빠른 통합이 가능해진다. 

### CDC 구현 방식
1. **Query-Based (Pull) 방식**
   - 타깃 시스템이 소스 시스템에서 데이터를 주기적으로 끌어온다.
   - 쉽게 구현 가능하지만 실시간성이 떨어지고 소스 시스템에 부하를 줄 수 있는 단점이 있다.
2. **Log-Based (Push) 방식**
   - 소스 시스템의 변경 시 타깃 시스템에 알린다.
   - 거의 실시간으로 데이터 변경 사항을 전송할 수 있으나 타깃 시스템 문제 시 변경 이벤트 누락 가능성이 있다.

### Kafka를 활용한 CDC 구현
![image](https://github.com/zisu17/zisu17/assets/108858121/e2d52ff8-4250-4353-9c28-6872c432ff9e)

- Kafka를 통해 타깃 시스템 문제 발생 시도 해당 지점부터 이벤트를 다시 읽어올 수 있어 누락 문제를 보완할 수 있다. 
- Debezium 커넥터를 활용하여 데이터베이스 변경 사항을 캡쳐하고 스트리밍한다. 
- 소스 커넥터와 싱크 커넥터를 통해 Kafka와 여러 데이터베이스 시스템 간 연결을 지원한다. 

**Apache 서비스 실행 및 Debezium 설치**
1. Zookeeper 서버와 Kafka 브로커 시작
2. Debezium 설치 및 Kafka Connect를 통한 구성

**Change Data Capture 실행**
- 데이터베이스 호스트, 포트, 사용자 이름, 비밀번호, 서버 ID 등을 사용하여 커넥터 구성
- 데이터베이스 트랜잭션 로그 모니터링 시작 및 변경 이벤트 생성

**변경 이벤트 Kafka로 스트리밍**
- Debezium 커넥터로 생성된 데이터베이스 변경 이벤트를 Kafka 소스 테이블명으로 전송
- Kafka Connect Converter를 사용하여 이벤트를 직렬화

**다운스트림 Consumer 생성**
- Kafka 토픽에서 데이터를 찾아 타겟 시스템에 저장

**성능 최적화**
- Kafka 및 Debezium 설정 최적화를 위한 배치 크기, 폴링 간격, 버퍼 크기 등 조정

**모니터링 및 유지 관리**
- 대기시간, 처리량, 오류율 등을 모니터링하며 로그 파일 및 리소스 사용량 모니터링
